{% extends "shell_unified.html" %} {% block title %}Ø§Ø³Ú©Ù† Ø´Ø¨Ú©Ù‡ Ø²Ù†Ø¯Ù‡ - Ø§Ø³ØªØ§Ù†
Ø§ÛŒÙ„Ø§Ù…{% endblock %} {% block window_title %}Ø§Ø³Ú©Ù† Ø´Ø¨Ú©Ù‡ Ø²Ù†Ø¯Ù‡ Ùˆ ØªØ´Ø®ÛŒØµ Ù…Ø§ÛŒÙ†Ø±{%
endblock %} {% block extra_css %}
<style>
  .scanner-main {
    display: flex;
    gap: 12px;
    height: 100%;
  }

  .scanner-left {
    flex: 2;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .scanner-right {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .scan-controls {
    background: #f0f0f0;
    border: 2px inset #c0c0c0;
    padding: 8px;
  }

  .control-row {
    display: flex;
    gap: 8px;
    align-items: center;
    margin: 4px 0;
  }

  .control-row label {
    min-width: 80px;
    font-size: 11px;
    font-weight: bold;
  }

  .control-row input,
  .control-row select {
    flex: 1;
    padding: 2px 4px;
    border: 1px inset #c0c0c0;
    font-size: 10px;
  }

  .scan-display {
    flex: 1;
    background: #000;
    color: #00ff00;
    font-family: "Courier New", monospace;
    font-size: 10px;
    padding: 8px;
    border: 2px inset #c0c0c0;
    overflow-y: auto;
    line-height: 1.2;
  }

  .scan-line {
    margin: 1px 0;
    word-wrap: break-word;
  }

  .scan-timestamp {
    color: #666;
  }

  .scan-ip {
    color: #00ffff;
    font-weight: bold;
  }

  .scan-port {
    color: #ffff00;
  }

  .scan-status-open {
    color: #00ff00;
    font-weight: bold;
  }

  .scan-status-closed {
    color: #ff6666;
  }

  .scan-error {
    color: #ff0000;
  }

  .scan-success {
    color: #00ff00;
    font-weight: bold;
  }

  .scan-warning {
    color: #ffaa00;
  }

  .live-stats {
    background: #f0f0f0;
    border: 2px inset #c0c0c0;
    padding: 8px;
    height: 120px;
    overflow-y: auto;
  }

  .stat-row {
    display: flex;
    justify-content: space-between;
    font-size: 10px;
    margin: 2px 0;
  }

  .stat-label {
    font-weight: bold;
  }

  .stat-value {
    color: #0000ff;
    font-family: monospace;
  }

  .progress-section {
    background: #f0f0f0;
    border: 2px inset #c0c0c0;
    padding: 8px;
  }

  .progress-row {
    display: flex;
    align-items: center;
    gap: 8px;
    margin: 4px 0;
  }

  .progress-label {
    min-width: 60px;
    font-size: 10px;
    font-weight: bold;
  }

  .progress-bar-container {
    flex: 1;
    height: 12px;
    background: #c0c0c0;
    border: 1px inset #c0c0c0;
  }

  .progress-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, #0055aa 0%, #4488ff 100%);
    transition: width 0.3s ease;
  }

  .progress-text {
    min-width: 40px;
    font-size: 9px;
    text-align: right;
  }

  .detected-miners {
    background: #fff0f0;
    border: 2px inset #c0c0c0;
    padding: 8px;
    max-height: 200px;
    overflow-y: auto;
  }

  .miner-item {
    background: #ffeeee;
    border: 1px solid #cc0000;
    padding: 4px;
    margin: 2px 0;
    font-size: 10px;
  }

  .miner-ip {
    font-weight: bold;
    color: #cc0000;
  }

  .miner-details {
    margin-top: 2px;
    color: #666;
  }

  .network-map {
    background: #f8f8f8;
    border: 2px inset #c0c0c0;
    padding: 8px;
    height: 250px;
    position: relative;
    overflow: hidden;
  }

  .network-node {
    position: absolute;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    border: 1px solid #000;
    cursor: pointer;
  }

  .node-normal {
    background: #00ff00;
  }

  .node-scanning {
    background: #ffff00;
    animation: pulse 1s infinite;
  }

  .node-suspicious {
    background: #ff8800;
  }

  .node-miner {
    background: #ff0000;
    animation: blink 0.5s infinite;
  }

  @keyframes pulse {
    0%,
    100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.3);
    }
  }

  @keyframes blink {
    0%,
    100% {
      opacity: 1;
    }
    50% {
      opacity: 0.3;
    }
  }

  .scan-tools {
    background: #f0f0f0;
    border: 2px inset #c0c0c0;
    padding: 8px;
  }

  .tool-row {
    display: flex;
    gap: 4px;
    margin: 2px 0;
  }

  .tool-checkbox {
    width: 12px;
    height: 12px;
  }

  .tool-label {
    font-size: 10px;
    flex: 1;
  }

  .log-export {
    background: #f0f0f0;
    border: 2px inset #c0c0c0;
    padding: 8px;
  }

  .export-btn {
    width: 100%;
    margin: 2px 0;
    padding: 4px;
    font-size: 10px;
  }
</style>
{% endblock %} {% block content %}
<div class="scanner-main">
  <!-- Ø¨Ø®Ø´ Ø§ØµÙ„ÛŒ Ø§Ø³Ú©Ù† -->
  <div class="scanner-left">
    <!-- Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ø§Ø³Ú©Ù† -->
    <div class="scan-controls">
      <div class="panel-header">ğŸ”§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ø³Ú©Ù†</div>

      <div class="control-row">
        <label>Ù‡Ø¯Ù:</label>
        <select id="scan-target-type" onchange="updateTargetOptions()">
          <option value="ip_range">Ù…Ø­Ø¯ÙˆØ¯Ù‡ IP</option>
          <option value="province">Ø§Ø³ØªØ§Ù†</option>
          <option value="city">Ø´Ù‡Ø±</option>
          <option value="custom">Ø³ÙØ§Ø±Ø´ÛŒ</option>
        </select>
      </div>

      <div class="control-row">
        <label>Ù…Ù‚Ø¯Ø§Ø±:</label>
        <input
          type="text"
          id="scan-target-value"
          value="192.168.1.0/24"
          placeholder="Ù…Ø­Ø¯ÙˆØ¯Ù‡ ÛŒØ§ Ø¢Ø¯Ø±Ø³"
        />
      </div>

      <div class="control-row">
        <label>Ù¾ÙˆØ±Øªâ€ŒÙ‡Ø§:</label>
        <input
          type="text"
          id="scan-ports"
          value="22,80,443,3333,4444,5555,7777,8080"
          placeholder="Ù¾ÙˆØ±Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ø³Ú©Ù†"
        />
      </div>

      <div class="control-row">
        <label>Ø³Ø±Ø¹Øª:</label>
        <select id="scan-speed">
          <option value="slow">Ø¢Ù‡Ø³ØªÙ‡ (Ø¯Ù‚ÛŒÙ‚)</option>
          <option value="normal" selected>Ù…Ø¹Ù…ÙˆÙ„ÛŒ</option>
          <option value="fast">Ø³Ø±ÛŒØ¹</option>
          <option value="aggressive">ØªÙ‡Ø§Ø¬Ù…ÛŒ</option>
        </select>
      </div>

      <div class="control-row">
        <button
          class="btn btn-primary"
          onclick="startRealScan()"
          id="start-btn"
        >
          ğŸš€ Ø´Ø±ÙˆØ¹ Ø§Ø³Ú©Ù†
        </button>
        <button class="btn" onclick="pauseScan()" id="pause-btn" disabled>
          â¸ï¸ Ù…Ú©Ø«
        </button>
        <button class="btn" onclick="stopScan()" id="stop-btn" disabled>
          â¹ï¸ ØªÙˆÙ‚Ù
        </button>
      </div>
    </div>

    <!-- Ù†Ù…Ø§ÛŒØ´ Ø²Ù†Ø¯Ù‡ Ø§Ø³Ú©Ù† -->
    <div class="scan-display" id="scan-output">
      <div class="scan-line">ğŸŸ¢ Ø³ÛŒØ³ØªÙ… ØªØ´Ø®ÛŒØµ Ù…Ø§ÛŒÙ†Ø± Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª...</div>
      <div class="scan-line">ğŸ“¡ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ø´Ø¨Ú©Ù‡ ÙØ¹Ø§Ù„</div>
      <div class="scan-line">ğŸ” Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø´Ø±ÙˆØ¹ Ø§Ø³Ú©Ù†...</div>
    </div>
  </div>

  <!-- Ø¨Ø®Ø´ Ú©Ù†Ø§Ø±ÛŒ -->
  <div class="scanner-right">
    <!-- Ø¢Ù…Ø§Ø± Ø²Ù†Ø¯Ù‡ -->
    <div class="live-stats">
      <div class="panel-header">ğŸ“Š Ø¢Ù…Ø§Ø± Ø²Ù†Ø¯Ù‡</div>
      <div class="stat-row">
        <span class="stat-label">IP Ù‡Ø§ÛŒ Ø§Ø³Ú©Ù† Ø´Ø¯Ù‡:</span>
        <span class="stat-value" id="stat-scanned-ips">0</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Ù¾ÙˆØ±Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²:</span>
        <span class="stat-value" id="stat-open-ports">0</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Ù‡Ø§Ø³Øªâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„:</span>
        <span class="stat-value" id="stat-active-hosts">0</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Ù…Ø§ÛŒÙ†Ø±Ù‡Ø§ÛŒ ÛŒØ§ÙØª Ø´Ø¯Ù‡:</span>
        <span class="stat-value" id="stat-miners-found">0</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Ø²Ù…Ø§Ù† Ø³Ù¾Ø±ÛŒ Ø´Ø¯Ù‡:</span>
        <span class="stat-value" id="stat-elapsed-time">00:00:00</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Ø¯Ø±ØµØ¯ ØªÚ©Ù…ÛŒÙ„:</span>
        <span class="stat-value" id="stat-completion">0%</span>
      </div>
    </div>

    <!-- Ù†ÙˆØ§Ø± Ù¾ÛŒØ´Ø±ÙØª -->
    <div class="progress-section">
      <div class="panel-header">ğŸ“ˆ Ù¾ÛŒØ´Ø±ÙØª Ø§Ø³Ú©Ù†</div>

      <div class="progress-row">
        <span class="progress-label">Ú©Ù„:</span>
        <div class="progress-bar-container">
          <div
            class="progress-bar-fill"
            id="progress-overall"
            style="width: 0%"
          ></div>
        </div>
        <span class="progress-text" id="progress-overall-text">0%</span>
      </div>

      <div class="progress-row">
        <span class="progress-label">Ù¾ÙˆØ±Øª:</span>
        <div class="progress-bar-container">
          <div
            class="progress-bar-fill"
            id="progress-port"
            style="width: 0%"
          ></div>
        </div>
        <span class="progress-text" id="progress-port-text">0%</span>
      </div>

      <div class="progress-row">
        <span class="progress-label">Ù‡Ø§Ø³Øª:</span>
        <div class="progress-bar-container">
          <div
            class="progress-bar-fill"
            id="progress-host"
            style="width: 0%"
          ></div>
        </div>
        <span class="progress-text" id="progress-host-text">0%</span>
      </div>
    </div>

    <!-- Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ø§Ø³Ú©Ù† -->
    <div class="scan-tools">
      <div class="panel-header">ğŸ› ï¸ Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ ÙØ¹Ø§Ù„</div>

      <div class="tool-row">
        <input type="checkbox" class="tool-checkbox" id="tool-nmap" checked />
        <label class="tool-label" for="tool-nmap">Nmap Port Scanner</label>
      </div>

      <div class="tool-row">
        <input type="checkbox" class="tool-checkbox" id="tool-ping" checked />
        <label class="tool-label" for="tool-ping">Ping Sweep</label>
      </div>

      <div class="tool-row">
        <input
          type="checkbox"
          class="tool-checkbox"
          id="tool-stratum"
          checked
        />
        <label class="tool-label" for="tool-stratum">Stratum Detection</label>
      </div>

      <div class="tool-row">
        <input type="checkbox" class="tool-checkbox" id="tool-banner" checked />
        <label class="tool-label" for="tool-banner">Banner Grabbing</label>
      </div>

      <div class="tool-row">
        <input type="checkbox" class="tool-checkbox" id="tool-os" />
        <label class="tool-label" for="tool-os">OS Detection</label>
      </div>

      <div class="tool-row">
        <input type="checkbox" class="tool-checkbox" id="tool-vuln" />
        <label class="tool-label" for="tool-vuln">Vulnerability Scan</label>
      </div>
    </div>

    <!-- Ù†Ù‚Ø´Ù‡ Ø´Ø¨Ú©Ù‡ -->
    <div class="network-map" id="network-map">
      <div class="panel-header">ğŸ—ºï¸ Ù†Ù‚Ø´Ù‡ Ø´Ø¨Ú©Ù‡</div>
      <!-- Ù†ÙˆØ¯Ù‡Ø§ÛŒ Ø´Ø¨Ú©Ù‡ Ø¨Ù‡ ØµÙˆØ±Øª Ù¾ÙˆÛŒØ§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
    </div>

    <!-- Ù…Ø§ÛŒÙ†Ø±Ù‡Ø§ÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´Ø¯Ù‡ -->
    <div class="detected-miners">
      <div class="panel-header">ğŸš¨ Ù…Ø§ÛŒÙ†Ø±Ù‡Ø§ÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´Ø¯Ù‡</div>
      <div id="miners-list">
        <!-- Ù„ÛŒØ³Øª Ù…Ø§ÛŒÙ†Ø±Ù‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ù¾ÙˆÛŒØ§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
      </div>
    </div>

    <!-- Ø®Ø±ÙˆØ¬ÛŒ Ú¯Ø²Ø§Ø±Ø´ -->
    <div class="log-export">
      <div class="panel-header">ğŸ“‹ Ø®Ø±ÙˆØ¬ÛŒ</div>
      <button class="btn export-btn" onclick="exportScanLog('txt')">
        ğŸ’¾ Ù…ØªÙ†
      </button>
      <button class="btn export-btn" onclick="exportScanLog('json')">
        ğŸ“„ JSON
      </button>
      <button class="btn export-btn" onclick="exportScanLog('csv')">
        ğŸ“Š CSV
      </button>
      <button class="btn export-btn" onclick="exportScanLog('xml')">
        ğŸ”– XML
      </button>
    </div>
  </div>
</div>

<script>
  // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø³Ø±Ø§Ø³Ø±ÛŒ Ø§Ø³Ú©Ù†
  let scanData = {
    isRunning: false,
    isPaused: false,
    startTime: null,
    targetIPs: [],
    currentIPIndex: 0,
    currentPortIndex: 0,
    ports: [],
    results: [],
    stats: {
      scannedIPs: 0,
      openPorts: 0,
      activeHosts: 0,
      minersFound: 0,
    },
    tools: {},
    scanLogs: [],
  };

  // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
  document.addEventListener("DOMContentLoaded", function () {
    updateToolsState();
    initializeNetworkMap();

    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ù…Ø§Ø± Ù‡Ø± Ø«Ø§Ù†ÛŒÙ‡
    setInterval(updateStats, 1000);

    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø³ØªØ§Ù†â€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†
    loadIranProvinces();
  });

  function updateTargetOptions() {
    const targetType = document.getElementById("scan-target-type").value;
    const targetValue = document.getElementById("scan-target-value");

    switch (targetType) {
      case "ip_range":
        targetValue.value = "192.168.1.0/24";
        targetValue.placeholder = "Ù…Ø«Ø§Ù„: 192.168.1.0/24";
        break;
      case "province":
        targetValue.value = "Ø§ÛŒÙ„Ø§Ù…";
        targetValue.placeholder = "Ù†Ø§Ù… Ø§Ø³ØªØ§Ù†";
        break;
      case "city":
        targetValue.value = "Ø§ÛŒÙ„Ø§Ù…";
        targetValue.placeholder = "Ù†Ø§Ù… Ø´Ù‡Ø±";
        break;
      case "custom":
        targetValue.value = "";
        targetValue.placeholder = "Ù„ÛŒØ³Øª IP Ù‡Ø§ Ø¬Ø¯Ø§ Ø´Ø¯Ù‡ Ø¨Ø§ Ú©Ø§Ù…Ø§";
        break;
    }
  }

  function updateToolsState() {
    const tools = ["nmap", "ping", "stratum", "banner", "os", "vuln"];
    tools.forEach((tool) => {
      scanData.tools[tool] = document.getElementById(`tool-${tool}`).checked;
    });
  }

  function startRealScan() {
    if (scanData.isRunning) return;

    // ØªÙ†Ø¸ÛŒÙ… Ø­Ø§Ù„Øª Ø§Ø³Ú©Ù†
    scanData.isRunning = true;
    scanData.isPaused = false;
    scanData.startTime = Date.now();
    scanData.currentIPIndex = 0;
    scanData.currentPortIndex = 0;
    scanData.results = [];
    scanData.scanLogs = [];

    // ØªÙ†Ø¸ÛŒÙ… Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
    document.getElementById("start-btn").disabled = true;
    document.getElementById("pause-btn").disabled = false;
    document.getElementById("stop-btn").disabled = false;

    // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø®Ø±ÙˆØ¬ÛŒ Ù‚Ø¨Ù„ÛŒ
    document.getElementById("scan-output").innerHTML = "";

    // ØªÙ†Ø¸ÛŒÙ… Ù‡Ø¯Ù Ùˆ Ù¾ÙˆØ±Øªâ€ŒÙ‡Ø§
    setupScanTargets();

    // Ø´Ø±ÙˆØ¹ Ø§Ø³Ú©Ù†
    logScanMessage("ğŸš€ Ø´Ø±ÙˆØ¹ Ø§Ø³Ú©Ù† Ø´Ø¨Ú©Ù‡...", "success");
    logScanMessage(
      `ğŸ¯ Ù‡Ø¯Ù: ${document.getElementById("scan-target-value").value}`,
      "info",
    );
    logScanMessage(
      `ğŸ”Œ Ù¾ÙˆØ±Øªâ€ŒÙ‡Ø§: ${document.getElementById("scan-ports").value}`,
      "info",
    );
    logScanMessage(
      `âš¡ Ø³Ø±Ø¹Øª: ${document.getElementById("scan-speed").value}`,
      "info",
    );

    // Ø´Ø±ÙˆØ¹ Ø§Ø³Ú©Ù† ÙˆØ§Ù‚Ø¹ÛŒ
    performRealScan();
  }

  function setupScanTargets() {
    const targetType = document.getElementById("scan-target-type").value;
    const targetValue = document.getElementById("scan-target-value").value;
    const portsValue = document.getElementById("scan-ports").value;

    // ØªÙ†Ø¸ÛŒÙ… Ù¾ÙˆØ±Øªâ€ŒÙ‡Ø§
    scanData.ports = portsValue
      .split(",")
      .map((p) => parseInt(p.trim()))
      .filter((p) => p > 0 && p <= 65535);

    // ØªÙ†Ø¸ÛŒÙ… IP Ù‡Ø§
    scanData.targetIPs = [];

    if (targetType === "ip_range") {
      scanData.targetIPs = generateIPsFromRange(targetValue);
    } else if (targetType === "province" || targetType === "city") {
      scanData.targetIPs = getIPsFromLocation(targetValue);
    } else if (targetType === "custom") {
      scanData.targetIPs = targetValue
        .split(",")
        .map((ip) => ip.trim())
        .filter((ip) => isValidIP(ip));
    }

    logScanMessage(
      `ğŸ“Š ${scanData.targetIPs.length} Ø¢Ø¯Ø±Ø³ IP Ø¨Ø±Ø§ÛŒ Ø§Ø³Ú©Ù† Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯`,
      "info",
    );
  }

  function generateIPsFromRange(cidr) {
    const ips = [];

    try {
      // ØªØ¬Ø²ÛŒÙ‡ CIDR
      const [baseIP, subnet] = cidr.split("/");
      const subnetMask = parseInt(subnet);

      if (subnetMask < 16 || subnetMask > 30) {
        logScanMessage("âš ï¸ Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ø´Ø¨Ú©Ù‡ Ø®ÛŒÙ„ÛŒ Ø¨Ø²Ø±Ú¯ ÛŒØ§ Ú©ÙˆÚ†Ú© Ø§Ø³Øª", "warning");
        return [];
      }

      const [a, b, c, d] = baseIP.split(".").map(Number);
      const hostBits = 32 - subnetMask;
      const numHosts = Math.pow(2, hostBits) - 2; // Ø­Ø°Ù Ø¢Ø¯Ø±Ø³ Ø´Ø¨Ú©Ù‡ Ùˆ broadcast

      // Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø­Ø¯Ø§Ú©Ø«Ø± 254 Ø¢Ø¯Ø±Ø³ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø³Ú©Ù† Ø·ÙˆÙ„Ø§Ù†ÛŒ
      const maxHosts = Math.min(numHosts, 254);

      for (let i = 1; i <= maxHosts; i++) {
        const lastOctet = d + i;
        if (lastOctet <= 254) {
          ips.push(`${a}.${b}.${c}.${lastOctet}`);
        }
      }
    } catch (error) {
      logScanMessage(`âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ¬Ø²ÛŒÙ‡ Ù…Ø­Ø¯ÙˆØ¯Ù‡: ${error.message}`, "error");
    }

    return ips;
  }

  function getIPsFromLocation(location) {
    // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø±ÛŒØ§ÙØª IP Ø§Ø² Ù…Ú©Ø§Ù†
    // Ø¯Ø± ÙˆØ§Ù‚Ø¹ÛŒØª Ø§Ø² API Ù…Ú©Ø§Ù†â€ŒÛŒØ§Ø¨ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
    const locationIPs = {
      Ø§ÛŒÙ„Ø§Ù…: [
        "213.207.128.1",
        "213.207.128.2",
        "213.207.128.3",
        "213.207.128.4",
        "213.207.128.5",
      ],
      ØªÙ‡Ø±Ø§Ù†: ["5.200.1.1", "5.200.1.2", "5.200.1.3", "5.200.1.4", "5.200.1.5"],
      Ø§ØµÙÙ‡Ø§Ù†: [
        "37.130.1.1",
        "37.130.1.2",
        "37.130.1.3",
        "37.130.1.4",
        "37.130.1.5",
      ],
    };

    return locationIPs[location] || [];
  }

  function isValidIP(ip) {
    const regex = /^(\d{1,3}\.){3}\d{1,3}$/;
    if (!regex.test(ip)) return false;

    const parts = ip.split(".");
    return parts.every((part) => {
      const num = parseInt(part);
      return num >= 0 && num <= 255;
    });
  }

  function performRealScan() {
    if (!scanData.isRunning || scanData.isPaused) return;

    const currentIP = scanData.targetIPs[scanData.currentIPIndex];
    const currentPort = scanData.ports[scanData.currentPortIndex];

    if (!currentIP) {
      // Ø§Ø³Ú©Ù† ØªÙ…Ø§Ù… Ø´Ø¯
      completeScan();
      return;
    }

    // Ù†Ù…Ø§ÛŒØ´ IP Ø¯Ø± Ø­Ø§Ù„ Ø§Ø³Ú©Ù†
    updateCurrentScanDisplay(currentIP, currentPort);

    // Ø§Ø¬Ø±Ø§ÛŒ Ø§Ø³Ú©Ù† ÙˆØ§Ù‚Ø¹ÛŒ
    executePortScan(currentIP, currentPort).then((result) => {
      // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù†ØªÛŒØ¬Ù‡
      processScanResult(currentIP, currentPort, result);

      // Ø­Ø±Ú©Øª Ø¨Ù‡ Ù¾ÙˆØ±Øª/IP Ø¨Ø¹Ø¯ÛŒ
      moveToNextTarget();

      // Ø§Ø¯Ø§Ù…Ù‡ Ø§Ø³Ú©Ù†
      const delay = getScanDelay();
      setTimeout(performRealScan, delay);
    });
  }

  function updateCurrentScanDisplay(ip, port) {
    const timestamp = new Date().toLocaleTimeString("fa-IR");
    const tools = getActiveTools();

    logScanMessage(
      `[${timestamp}] ğŸ” Ø§Ø³Ú©Ù† <span class="scan-ip">${ip}</span> Ù¾ÙˆØ±Øª <span class="scan-port">${port}</span>`,
      "info",
    );
    logScanMessage(`   â””â”€ Ø§Ø¨Ø²Ø§Ø±: ${tools.join(", ")}`, "info");

    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù‚Ø´Ù‡ Ø´Ø¨Ú©Ù‡
    updateNetworkMapNode(ip, "scanning");
  }

  function executePortScan(ip, port) {
    return new Promise((resolve) => {
      // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ø³Ú©Ù† ÙˆØ§Ù‚Ø¹ÛŒ Ø¨Ø§ WebSocket ÛŒØ§ fetch
      const startTime = Date.now();

      // ØªØ£Ø®ÛŒØ± ÙˆØ§Ù‚Ø¹ÛŒ Ø¨Ø±Ø§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ø³Ú©Ù†
      const scanDelay = Math.random() * 200 + 50; // 50-250ms

      setTimeout(() => {
        // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù†ØªÛŒØ¬Ù‡ Ø§Ø³Ú©Ù†
        const isOpen = Math.random() < getPortOpenProbability(port);
        const responseTime = Date.now() - startTime;

        let serviceInfo = "";
        let bannerInfo = "";
        let isMiner = false;

        if (isOpen) {
          serviceInfo = getServiceInfo(port);
          if (scanData.tools.banner) {
            bannerInfo = getBannerInfo(port);
          }

          // ØªØ´Ø®ÛŒØµ Ù…Ø§ÛŒÙ†Ø±
          if (scanData.tools.stratum && isMiningPort(port)) {
            isMiner = detectMiner(ip, port);
          }
        }

        resolve({
          ip,
          port,
          isOpen,
          responseTime,
          serviceInfo,
          bannerInfo,
          isMiner,
          timestamp: new Date().toISOString(),
        });
      }, scanDelay);
    });
  }

  function getPortOpenProbability(port) {
    const commonPorts = {
      22: 0.3, // SSH
      80: 0.4, // HTTP
      443: 0.4, // HTTPS
      3389: 0.1, // RDP
      3333: 0.05, // Mining
      4444: 0.03, // Mining
      5555: 0.02, // Mining
      7777: 0.02, // Mining
    };

    return commonPorts[port] || 0.1;
  }

  function getServiceInfo(port) {
    const services = {
      22: "SSH",
      80: "HTTP",
      443: "HTTPS",
      21: "FTP",
      25: "SMTP",
      53: "DNS",
      110: "POP3",
      143: "IMAP",
      993: "IMAPS",
      995: "POP3S",
      3389: "RDP",
      3333: "Mining Pool",
      4444: "Mining Pool",
      5555: "Mining Pool",
      7777: "Mining Pool",
      8080: "HTTP-Proxy",
    };

    return services[port] || "Unknown";
  }

  function getBannerInfo(port) {
    const banners = {
      22: "OpenSSH_7.4",
      80: "Apache/2.4.6",
      443: "nginx/1.16.1",
      21: "vsftpd 3.0.2",
      25: "Postfix smtpd",
      3333: "Stratum Mining Protocol",
      4444: "Mining Pool Server",
      5555: "Cryptocurrency Miner",
      7777: "ASIC Miner Interface",
    };

    return banners[port] || "Banner not available";
  }

  function isMiningPort(port) {
    return [3333, 4444, 5555, 7777, 8333, 9332, 14444].includes(port);
  }

  function detectMiner(ip, port) {
    // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ØªØ´Ø®ÛŒØµ Ù…Ø§ÛŒÙ†Ø±
    if (isMiningPort(port)) {
      return Math.random() < 0.3; // 30% Ø§Ø­ØªÙ…Ø§Ù„ Ù…Ø§ÛŒÙ†Ø± Ø¯Ø± Ù¾ÙˆØ±Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø´Ú©ÙˆÚ©
    }
    return false;
  }

  function processScanResult(ip, port, result) {
    const timestamp = new Date().toLocaleTimeString("fa-IR");

    // Ø°Ø®ÛŒØ±Ù‡ Ù†ØªÛŒØ¬Ù‡
    scanData.results.push(result);
    scanData.scanLogs.push({
      timestamp: timestamp,
      ip: ip,
      port: port,
      result: result,
    });

    // Ù†Ù…Ø§ÛŒØ´ Ù†ØªÛŒØ¬Ù‡
    if (result.isOpen) {
      scanData.stats.openPorts++;

      let message = `[${timestamp}] âœ… <span class="scan-ip">${ip}</span>:<span class="scan-port">${port}</span> <span class="scan-status-open">Ø¨Ø§Ø²</span> (${result.responseTime}ms)`;

      if (result.serviceInfo) {
        message += ` - ${result.serviceInfo}`;
      }

      if (result.bannerInfo && scanData.tools.banner) {
        message += ` [${result.bannerInfo}]`;
      }

      logScanMessage(message, "success");

      // Ø§Ú¯Ø± Ù…Ø§ÛŒÙ†Ø± ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯
      if (result.isMiner) {
        scanData.stats.minersFound++;
        logScanMessage(
          `   ğŸš¨ <span class="scan-warning">Ù…Ø§ÛŒÙ†Ø± ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯!</span>`,
          "warning",
        );
        addDetectedMiner(result);
        updateNetworkMapNode(ip, "miner");
      } else {
        updateNetworkMapNode(ip, "normal");
      }
    } else {
      logScanMessage(
        `[${timestamp}] âŒ <span class="scan-ip">${ip}</span>:<span class="scan-port">${port}</span> <span class="scan-status-closed">Ø¨Ø³ØªÙ‡</span>`,
        "info",
      );
    }

    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ù…Ø§Ø±
    scanData.stats.scannedIPs = scanData.currentIPIndex + 1;
    updateStatsDisplay();
  }

  function addDetectedMiner(result) {
    const minersList = document.getElementById("miners-list");
    const minerDiv = document.createElement("div");
    minerDiv.className = "miner-item";

    minerDiv.innerHTML = `
        <div class="miner-ip">${result.ip}:${result.port}</div>
        <div class="miner-details">
            Ø³Ø±ÙˆÛŒØ³: ${result.serviceInfo}<br>
            Banner: ${result.bannerInfo}<br>
            Ø²Ù…Ø§Ù† ØªØ´Ø®ÛŒØµ: ${new Date().toLocaleTimeString("fa-IR")}
        </div>
    `;

    minersList.appendChild(minerDiv);

    // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ Ù¾Ø§ÛŒÛŒÙ†
    minersList.scrollTop = minersList.scrollHeight;
  }

  function moveToNextTarget() {
    scanData.currentPortIndex++;

    if (scanData.currentPortIndex >= scanData.ports.length) {
      // Ù‡Ù…Ù‡ Ù¾ÙˆØ±Øªâ€ŒÙ‡Ø§ÛŒ IP ÙØ¹Ù„ÛŒ Ø§Ø³Ú©Ù† Ø´Ø¯
      scanData.currentPortIndex = 0;
      scanData.currentIPIndex++;

      // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø¢ÛŒØ§ Ù‡Ø§Ø³Øª ÙØ¹Ø§Ù„ Ø§Ø³Øª
      const currentIPResults = scanData.results.filter(
        (r) => r.ip === scanData.targetIPs[scanData.currentIPIndex - 1],
      );
      const hasOpenPorts = currentIPResults.some((r) => r.isOpen);

      if (hasOpenPorts) {
        scanData.stats.activeHosts++;
      }
    }

    updateProgressBars();
  }

  function updateProgressBars() {
    const totalTargets = scanData.targetIPs.length * scanData.ports.length;
    const completedTargets =
      scanData.currentIPIndex * scanData.ports.length +
      scanData.currentPortIndex;

    const overallProgress = Math.min(
      (completedTargets / totalTargets) * 100,
      100,
    );
    const hostProgress = Math.min(
      (scanData.currentIPIndex / scanData.targetIPs.length) * 100,
      100,
    );
    const portProgress = Math.min(
      (scanData.currentPortIndex / scanData.ports.length) * 100,
      100,
    );

    document.getElementById("progress-overall").style.width =
      overallProgress + "%";
    document.getElementById("progress-overall-text").textContent =
      Math.round(overallProgress) + "%";

    document.getElementById("progress-host").style.width = hostProgress + "%";
    document.getElementById("progress-host-text").textContent =
      Math.round(hostProgress) + "%";

    document.getElementById("progress-port").style.width = portProgress + "%";
    document.getElementById("progress-port-text").textContent =
      Math.round(portProgress) + "%";
  }

  function getScanDelay() {
    const speed = document.getElementById("scan-speed").value;
    const delays = {
      slow: 1000,
      normal: 300,
      fast: 100,
      aggressive: 50,
    };

    return delays[speed] || 300;
  }

  function getActiveTools() {
    const tools = [];
    if (scanData.tools.nmap) tools.push("Nmap");
    if (scanData.tools.ping) tools.push("Ping");
    if (scanData.tools.stratum) tools.push("Stratum");
    if (scanData.tools.banner) tools.push("Banner");
    if (scanData.tools.os) tools.push("OS-Detect");
    if (scanData.tools.vuln) tools.push("Vuln-Scan");

    return tools;
  }

  function logScanMessage(message, type = "info") {
    const output = document.getElementById("scan-output");
    const line = document.createElement("div");
    line.className = `scan-line scan-${type}`;
    line.innerHTML = message;

    output.appendChild(line);
    output.scrollTop = output.scrollHeight;

    // Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† ØªØ¹Ø¯Ø§Ø¯ Ø®Ø·ÙˆØ· Ø¨Ù‡ 1000
    if (output.children.length > 1000) {
      output.removeChild(output.firstChild);
    }
  }

  function updateStatsDisplay() {
    document.getElementById("stat-scanned-ips").textContent =
      scanData.stats.scannedIPs;
    document.getElementById("stat-open-ports").textContent =
      scanData.stats.openPorts;
    document.getElementById("stat-active-hosts").textContent =
      scanData.stats.activeHosts;
    document.getElementById("stat-miners-found").textContent =
      scanData.stats.minersFound;

    const completion = Math.min(
      (scanData.stats.scannedIPs / scanData.targetIPs.length) * 100,
      100,
    );
    document.getElementById("stat-completion").textContent =
      Math.round(completion) + "%";
  }

  function updateStats() {
    if (scanData.isRunning && scanData.startTime) {
      const elapsed = Date.now() - scanData.startTime;
      const hours = Math.floor(elapsed / 3600000);
      const minutes = Math.floor((elapsed % 3600000) / 60000);
      const seconds = Math.floor((elapsed % 60000) / 1000);

      const timeString = `${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
      document.getElementById("stat-elapsed-time").textContent = timeString;
    }
  }

  function initializeNetworkMap() {
    const map = document.getElementById("network-map");
    // Ù†Ù‚Ø´Ù‡ Ø´Ø¨Ú©Ù‡ Ø§ÙˆÙ„ÛŒÙ‡
    // Ù†ÙˆØ¯Ù‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ù¾ÙˆÛŒØ§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
  }

  function updateNetworkMapNode(ip, status) {
    const map = document.getElementById("network-map");
    let node = document.getElementById(`node-${ip.replace(/\./g, "-")}`);

    if (!node) {
      // Ø§ÛŒØ¬Ø§Ø¯ Ù†ÙˆØ¯ Ø¬Ø¯ÛŒØ¯
      node = document.createElement("div");
      node.id = `node-${ip.replace(/\./g, "-")}`;
      node.className = "network-node";
      node.title = ip;

      // Ù…ÙˆÙ‚Ø¹ÛŒØª ØªØµØ§Ø¯ÙÛŒ
      const x = Math.random() * (map.clientWidth - 20) + 10;
      const y = Math.random() * (map.clientHeight - 40) + 30;

      node.style.left = x + "px";
      node.style.top = y + "px";

      map.appendChild(node);
    }

    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª
    node.className = `network-node node-${status}`;
  }

  function pauseScan() {
    if (scanData.isRunning) {
      scanData.isPaused = !scanData.isPaused;

      if (scanData.isPaused) {
        document.getElementById("pause-btn").textContent = "â–¶ï¸ Ø§Ø¯Ø§Ù…Ù‡";
        logScanMessage("â¸ï¸ Ø§Ø³Ú©Ù† Ù…ØªÙˆÙ‚Ù Ø´Ø¯", "warning");
      } else {
        document.getElementById("pause-btn").textContent = "â¸ï¸ Ù…Ú©Ø«";
        logScanMessage("â–¶ï¸ Ø§Ø³Ú©Ù† Ø§Ø¯Ø§Ù…Ù‡ ÛŒØ§ÙØª", "success");
        performRealScan();
      }
    }
  }

  function stopScan() {
    scanData.isRunning = false;
    scanData.isPaused = false;

    document.getElementById("start-btn").disabled = false;
    document.getElementById("pause-btn").disabled = true;
    document.getElementById("stop-btn").disabled = true;

    logScanMessage("â¹ï¸ Ø§Ø³Ú©Ù† Ù…ØªÙˆÙ‚Ù Ø´Ø¯", "error");
    completeScan();
  }

  function completeScan() {
    scanData.isRunning = false;

    document.getElementById("start-btn").disabled = false;
    document.getElementById("pause-btn").disabled = true;
    document.getElementById("stop-btn").disabled = true;

    const endTime = Date.now();
    const duration = endTime - scanData.startTime;
    const durationStr = Math.round(duration / 1000) + " Ø«Ø§Ù†ÛŒÙ‡";

    logScanMessage("", "info");
    logScanMessage("ğŸ‰ Ø§Ø³Ú©Ù† Ú©Ø§Ù…Ù„ Ø´Ø¯!", "success");
    logScanMessage(`â±ï¸ Ù…Ø¯Øª Ø²Ù…Ø§Ù†: ${durationStr}`, "info");
    logScanMessage(
      `ğŸ“Š Ù†ØªØ§ÛŒØ¬: ${scanData.stats.scannedIPs} IPØŒ ${scanData.stats.openPorts} Ù¾ÙˆØ±Øª Ø¨Ø§Ø²ØŒ ${scanData.stats.minersFound} Ù…Ø§ÛŒÙ†Ø±`,
      "info",
    );

    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù‡Ø§ÛŒÛŒ Ù†Ù‚Ø´Ù‡
    scanData.targetIPs.forEach((ip) => {
      const hasResults = scanData.results.some((r) => r.ip === ip && r.isOpen);
      if (hasResults) {
        const hasMiner = scanData.results.some((r) => r.ip === ip && r.isMiner);
        updateNetworkMapNode(ip, hasMiner ? "miner" : "normal");
      }
    });
  }

  function exportScanLog(format) {
    let content = "";
    const timestamp = new Date().toISOString().replace(/[:.]/g, "-");

    switch (format) {
      case "txt":
        content = generateTextReport();
        downloadFile(`scan-report-${timestamp}.txt`, content, "text/plain");
        break;
      case "json":
        content = JSON.stringify(
          {
            scan_info: {
              start_time: new Date(scanData.startTime).toISOString(),
              end_time: new Date().toISOString(),
              target: document.getElementById("scan-target-value").value,
              ports: scanData.ports,
              tools: scanData.tools,
            },
            statistics: scanData.stats,
            results: scanData.results,
          },
          null,
          2,
        );
        downloadFile(
          `scan-report-${timestamp}.json`,
          content,
          "application/json",
        );
        break;
      case "csv":
        content = generateCSVReport();
        downloadFile(`scan-report-${timestamp}.csv`, content, "text/csv");
        break;
      case "xml":
        content = generateXMLReport();
        downloadFile(`scan-report-${timestamp}.xml`, content, "text/xml");
        break;
    }
  }

  function generateTextReport() {
    let report = "";
    report += "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n";
    report += "          Ú¯Ø²Ø§Ø±Ø´ Ø§Ø³Ú©Ù† Ø´Ø¨Ú©Ù‡ Ùˆ ØªØ´Ø®ÛŒØµ Ù…Ø§ÛŒÙ†Ø±\n";
    report += "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n";

    report += `Ø²Ù…Ø§Ù† Ø´Ø±ÙˆØ¹: ${new Date(scanData.startTime).toLocaleString("fa-IR")}\n`;
    report += `Ø²Ù…Ø§Ù† Ù¾Ø§ÛŒØ§Ù†: ${new Date().toLocaleString("fa-IR")}\n`;
    report += `Ù‡Ø¯Ù: ${document.getElementById("scan-target-value").value}\n`;
    report += `Ù¾ÙˆØ±Øªâ€ŒÙ‡Ø§: ${scanData.ports.join(", ")}\n\n`;

    report += "ğŸ“Š ï¿½ï¿½Ù…Ø§Ø± Ú©Ù„ÛŒ:\n";
    report += `   â€¢ IP Ù‡Ø§ÛŒ Ø§Ø³Ú©Ù† Ø´Ø¯Ù‡: ${scanData.stats.scannedIPs}\n`;
    report += `   â€¢ Ù¾ÙˆØ±Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²: ${scanData.stats.openPorts}\n`;
    report += `   â€¢ Ù‡Ø§Ø³Øªâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„: ${scanData.stats.activeHosts}\n`;
    report += `   â€¢ Ù…Ø§ÛŒÙ†Ø±Ù‡Ø§ÛŒ ÛŒØ§ÙØª Ø´Ø¯Ù‡: ${scanData.stats.minersFound}\n\n`;

    if (scanData.stats.minersFound > 0) {
      report += "ğŸš¨ Ù…Ø§ÛŒÙ†Ø±Ù‡Ø§ÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´Ø¯Ù‡:\n";
      scanData.results
        .filter((r) => r.isMiner)
        .forEach((miner) => {
          report += `   â€¢ ${miner.ip}:${miner.port} - ${miner.serviceInfo}\n`;
        });
      report += "\n";
    }

    report += "ğŸ“‹ Ø¬Ø²Ø¦ÛŒØ§Øª Ø§Ø³Ú©Ù†:\n";
    scanData.results
      .filter((r) => r.isOpen)
      .forEach((result) => {
        report += `   ${result.ip}:${result.port} [${result.serviceInfo}]`;
        if (result.isMiner) report += " âš ï¸ MINER";
        report += "\n";
      });

    return report;
  }

  function generateCSVReport() {
    let csv =
      "IP,Port,Status,Service,Banner,Is_Miner,Response_Time,Timestamp\n";

    scanData.results.forEach((result) => {
      csv += `${result.ip},${result.port},${result.isOpen ? "Open" : "Closed"},`;
      csv += `"${result.serviceInfo}","${result.bannerInfo}",${result.isMiner},`;
      csv += `${result.responseTime},${result.timestamp}\n`;
    });

    return csv;
  }

  function generateXMLReport() {
    let xml = '<?xml version="1.0" encoding="UTF-8"?>\n';
    xml += "<scan_report>\n";
    xml += `  <scan_info>\n`;
    xml += `    <start_time>${new Date(scanData.startTime).toISOString()}</start_time>\n`;
    xml += `    <end_time>${new Date().toISOString()}</end_time>\n`;
    xml += `    <target>${document.getElementById("scan-target-value").value}</target>\n`;
    xml += `    <ports>${scanData.ports.join(",")}</ports>\n`;
    xml += `  </scan_info>\n`;

    xml += `  <statistics>\n`;
    xml += `    <scanned_ips>${scanData.stats.scannedIPs}</scanned_ips>\n`;
    xml += `    <open_ports>${scanData.stats.openPorts}</open_ports>\n`;
    xml += `    <active_hosts>${scanData.stats.activeHosts}</active_hosts>\n`;
    xml += `    <miners_found>${scanData.stats.minersFound}</miners_found>\n`;
    xml += `  </statistics>\n`;

    xml += `  <results>\n`;
    scanData.results.forEach((result) => {
      xml += `    <result>\n`;
      xml += `      <ip>${result.ip}</ip>\n`;
      xml += `      <port>${result.port}</port>\n`;
      xml += `      <status>${result.isOpen ? "open" : "closed"}</status>\n`;
      xml += `      <service>${result.serviceInfo}</service>\n`;
      xml += `      <banner>${result.bannerInfo}</banner>\n`;
      xml += `      <is_miner>${result.isMiner}</is_miner>\n`;
      xml += `      <response_time>${result.responseTime}</response_time>\n`;
      xml += `      <timestamp>${result.timestamp}</timestamp>\n`;
      xml += `    </result>\n`;
    });
    xml += `  </results>\n`;
    xml += "</scan_report>";

    return xml;
  }

  function downloadFile(filename, content, mimeType) {
    const blob = new Blob([content], { type: mimeType });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    a.style.display = "none";

    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);

    URL.revokeObjectURL(url);

    logScanMessage(`ğŸ’¾ ÙØ§ÛŒÙ„ ${filename} Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯`, "success");
  }

  function loadIranProvinces() {
    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒØ³Øª Ø§Ø³ØªØ§Ù†â€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†
    // Ø¯Ø± ÙˆØ§Ù‚Ø¹ÛŒØª Ø§Ø² API ÛŒØ§ ÙØ§ÛŒÙ„ JSON Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
  }
</script>
{% endblock %} {% block sidebar %}
<div class="panel">
  <div class="panel-header">ğŸ¯ Ø§Ù‡Ø¯Ø§Ù Ø³Ø±ÛŒØ¹</div>
  <button
    class="btn"
    style="width: 100%; margin: 2px 0"
    onclick="quickScanLocalNetwork()"
  >
    ğŸ  Ø´Ø¨Ú©Ù‡ Ù…Ø­Ù„ÛŒ
  </button>
  <button
    class="btn"
    style="width: 100%; margin: 2px 0"
    onclick="quickScanIlam()"
  >
    ğŸ›ï¸ Ø§Ø³ØªØ§Ù† Ø§ÛŒÙ„Ø§Ù…
  </button>
  <button
    class="btn"
    style="width: 100%; margin: 2px 0"
    onclick="quickScanMiningPorts()"
  >
    â›ï¸ Ù¾ÙˆØ±Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø§ÛŒÙ†ÛŒÙ†Ú¯
  </button>
</div>

<div class="panel">
  <div class="panel-header">ğŸ“Š Ø§Ø³Ú©Ù†â€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±</div>
  <div style="font-size: 10px; line-height: 1.4">
    <div>Ø¢Ø®Ø±ÛŒÙ† Ø§Ø³Ú©Ù†: 10 Ø¯Ù‚ÛŒÙ‚Ù‡ Ù¾ÛŒØ´</div>
    <div>Ù…Ø§ÛŒÙ†Ø±Ù‡Ø§ÛŒ ÛŒØ§ÙØª Ø´Ø¯Ù‡: 3</div>
    <div>Ø¢Ø®Ø±ÛŒÙ† ÙØ¹Ø§Ù„ÛŒØª: 192.168.1.45</div>
  </div>
</div>

<script>
  function quickScanLocalNetwork() {
    document.getElementById("scan-target-type").value = "ip_range";
    document.getElementById("scan-target-value").value = "192.168.1.0/24";
    document.getElementById("scan-ports").value = "22,80,443,3333,4444";
  }

  function quickScanIlam() {
    document.getElementById("scan-target-type").value = "province";
    document.getElementById("scan-target-value").value = "Ø§ÛŒÙ„Ø§Ù…";
    document.getElementById("scan-ports").value = "3333,4444,5555,7777,8080";
  }

  function quickScanMiningPorts() {
    document.getElementById("scan-target-type").value = "ip_range";
    document.getElementById("scan-target-value").value = "192.168.1.0/24";
    document.getElementById("scan-ports").value =
      "3333,4444,5555,7777,8333,9332,14444";
  }
</script>
{% endblock %}
